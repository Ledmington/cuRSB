<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>librsb: examples/fortran_rsb_fi.F90 File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">librsb
   &#160;<span id="projectnumber">1.3.0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d28a4824dc47e487b107a5db32ef43c4.html">examples</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">fortran_rsb_fi.F90 File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>RSB.F90-based usage: <a class="el" href="group__rsb__doc__rsb.html#ga86c1b0d0586f817ee31ca1caa3fee9be">rsb_mtx_alloc_from_coo_const()</a>, <a class="el" href="group__rsb__doc__rsb.html#ga8c11024d248e2e686476fd9e89aa7c15">rsb_tune_spmm()</a>, <a class="el" href="group__rsb__doc__rsb.html#gad911ac7528c95c874d02cb17e6b76c54">rsb_file_mtx_save()</a>, <a class="el" href="group__rsb__doc__rsb.html#ga4a16a82d289c76a437915db449553d4d">rsb_spmv()</a>, ...  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:a81bb92e0655a22d251331911eea093ba"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fortran__rsb__fi_8F90.html#a81bb92e0655a22d251331911eea093ba">rsb_mod_example1</a> (res)</td></tr>
<tr class="separator:a81bb92e0655a22d251331911eea093ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae69a37936a1ca7d8cf7d273b891bc57c"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fortran__rsb__fi_8F90.html#ae69a37936a1ca7d8cf7d273b891bc57c">rsb_mod_example2</a> (res)</td></tr>
<tr class="separator:ae69a37936a1ca7d8cf7d273b891bc57c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab17498c86a79e053e959b9dab423b8e9"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fortran__rsb__fi_8F90.html#ab17498c86a79e053e959b9dab423b8e9">rsb_mod_example3</a> (res)</td></tr>
<tr class="separator:ab17498c86a79e053e959b9dab423b8e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ec2266d83cd6c0b762cbcbc92c0af3d"><td class="memItemLeft" align="right" valign="top">program&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fortran__rsb__fi_8F90.html#a8ec2266d83cd6c0b762cbcbc92c0af3d">main</a></td></tr>
<tr class="separator:a8ec2266d83cd6c0b762cbcbc92c0af3d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>RSB.F90-based usage: <a class="el" href="group__rsb__doc__rsb.html#ga86c1b0d0586f817ee31ca1caa3fee9be">rsb_mtx_alloc_from_coo_const()</a>, <a class="el" href="group__rsb__doc__rsb.html#ga8c11024d248e2e686476fd9e89aa7c15">rsb_tune_spmm()</a>, <a class="el" href="group__rsb__doc__rsb.html#gad911ac7528c95c874d02cb17e6b76c54">rsb_file_mtx_save()</a>, <a class="el" href="group__rsb__doc__rsb.html#ga4a16a82d289c76a437915db449553d4d">rsb_spmv()</a>, ... </p>
<div class="fragment"><div class="line"><span class="comment">! </span></div><div class="line"><span class="comment">! Copyright (C) 2008-2022 Michele Martone</span></div><div class="line"><span class="comment">! </span></div><div class="line"><span class="comment">! This file is part of librsb.</span></div><div class="line"><span class="comment">! </span></div><div class="line"><span class="comment">! librsb is free software; you can redistribute it and/or modify it</span></div><div class="line"><span class="comment">! under the terms of the GNU Lesser General Public License as published</span></div><div class="line"><span class="comment">! by the Free Software Foundation; either version 3 of the License, or</span></div><div class="line"><span class="comment">! (at your option) any later version.</span></div><div class="line"><span class="comment">! </span></div><div class="line"><span class="comment">! librsb is distributed in the hope that it will be useful, but WITHOUT</span></div><div class="line"><span class="comment">! ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span></div><div class="line"><span class="comment">! FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public</span></div><div class="line"><span class="comment">! License for more details.</span></div><div class="line"><span class="comment">! </span></div><div class="line"><span class="comment">! You should have received a copy of the GNU Lesser General Public</span></div><div class="line"><span class="comment">! License along with librsb; see the file COPYING.</span></div><div class="line"><span class="comment">! If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div><div class="line"><span class="comment">! </span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">!&gt; @file.</span></div><div class="line"><span class="comment">!! @brief RSB.F90-based usage:</span></div><div class="line"><span class="comment">!!        rsb_mtx_alloc_from_coo_const(),</span></div><div class="line"><span class="comment">!!        rsb_tune_spmm(),</span></div><div class="line"><span class="comment">!!        rsb_file_mtx_save(),</span></div><div class="line"><span class="comment">!!        rsb_spmv(),</span></div><div class="line"><span class="comment">!!        ...</span></div><div class="line"><span class="comment">!! \include fortran_rsb_fi.F90</span></div><div class="line"></div><div class="line"><span class="keyword">      SUBROUTINE </span><a class="code" href="fortran__rsb__fi_8F90.html#a81bb92e0655a22d251331911eea093ba">rsb_mod_example1</a>(res)</div><div class="line"><span class="comment">! Example using an unsymmetric matrix specified as COO, and autotuning, built at once.</span></div><div class="line">      <span class="keywordtype">USE </span><a class="code" href="namespacersb.html">rsb</a></div><div class="line">      <span class="keywordtype">USE </span>iso_c_binding</div><div class="line">      <span class="keywordtype">IMPLICIT NONE</span></div><div class="line">      <span class="keywordtype">INTEGER</span> ::res</div><div class="line">      <span class="keywordtype">INTEGER</span>,<span class="keywordtype">TARGET</span> :: istat = 0, i</div><div class="line">      <span class="keywordtype">INTEGER</span> :: transt = <a class="code" href="namespacersb.html#a89c7627f24fecaf23ead8300f671314f">rsb_transposition_n</a> <span class="comment">!</span></div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span> :: incx = 1, incy = 1</div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span>,<span class="keywordtype">TARGET</span> :: alpha = 3, beta = 1</div><div class="line"><span class="comment">! 1 1</span></div><div class="line"><span class="comment">! 1 1</span></div><div class="line">      <span class="comment">! declaration of VA,IA,JA </span></div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span> :: nnz = 4</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span> :: nr = 2</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span> :: nc = 2</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span> :: nrhs = 1</div><div class="line">      <span class="keywordtype">INTEGER</span> :: order = <a class="code" href="namespacersb.html#a8786a38b2ca41b926b8ef6092a55b8a6">rsb_flag_want_column_major_order</a> <span class="comment">! rhs layout</span></div><div class="line">      <span class="keywordtype">INTEGER</span> :: flags = <a class="code" href="namespacersb.html#a65dbcb1d6e6347e5b7e85b5aa49db90c">rsb_flag_noflags</a> </div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span>,<span class="keywordtype">TARGET</span> :: ia(4) = (/0, 1, 1,0/)</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span>,<span class="keywordtype">TARGET</span> :: ja(4) = (/0, 0, 1,1/)</div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span>,<span class="keywordtype">TARGET</span> :: va(4) = (/1,1,1,1/)</div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span>,<span class="keywordtype">TARGET</span> :: x(2) = (/1, 1/)<span class="comment">! reference x </span></div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span>,<span class="keywordtype">TARGET</span> :: cy(2) = (/9, 9/)<span class="comment">! reference cy after </span></div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span>,<span class="keywordtype">TARGET</span> :: y(2) = (/3, 3/)<span class="comment">! y will be overwritten</span></div><div class="line">      <span class="keywordtype">TYPE</span>(c_ptr),<span class="keywordtype">TARGET</span> :: mtxap = c_null_ptr <span class="comment">! matrix pointer</span></div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span> :: tmax = 2.0 <span class="comment">! tuning max time</span></div><div class="line">      <span class="keywordtype">INTEGER</span> :: titmax = 2 <span class="comment">! tuning max iterations</span></div><div class="line">      <span class="keywordtype">INTEGER</span>,<span class="keywordtype">TARGET</span> :: ont = 0     <span class="comment">! optimal number of threads</span></div><div class="line">      <span class="comment">!TYPE(C_PTR),PARAMETER :: EO = RSB_NULL_EXIT_OPTIONS</span></div><div class="line">      <span class="comment">!TYPE(C_PTR),PARAMETER :: IO = RSB_NULL_INIT_OPTIONS</span></div><div class="line">      <span class="comment">! Note: using C_NULL_PTR instead of the previous lines because of http://gcc.gnu.org/bugzilla/show_bug.cgi?id=59411</span></div><div class="line">      <span class="keywordtype">TYPE</span>(c_ptr),<span class="keywordtype">PARAMETER</span> :: eo = c_null_ptr</div><div class="line">      <span class="keywordtype">TYPE</span>(c_ptr),<span class="keywordtype">PARAMETER</span> :: io = c_null_ptr</div><div class="line">      <span class="keywordtype">INTEGER</span>,<span class="keywordtype">TARGET</span> :: errval</div><div class="line"></div><div class="line">      res = 0</div><div class="line"></div><div class="line">      errval = <a class="code" href="interfacersb_1_1rsb__lib__init.html">rsb_lib_init</a>(io)</div><div class="line">      <span class="keywordflow">IF</span> (errval.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>) <span class="keywordflow">GOTO</span> 9997</div><div class="line"></div><div class="line">      mtxap = <a class="code" href="interfacersb_1_1rsb__mtx__alloc__from__coo__const.html">rsb_mtx_alloc_from_coo_const</a>(c_loc(va),c_loc(ia),c_loc(ja)&amp;</div><div class="line">       &amp;,nnz,&amp;</div><div class="line">       &amp; <a class="code" href="namespacersb.html#af833bb7a31acb188d33424c3c16bd4cd">rsb_numerical_type_double</a>,nr,nc,1,1,flags,c_loc(istat))</div><div class="line"></div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>) <span class="keywordflow">GOTO</span> 9997</div><div class="line"></div><div class="line">      istat = <a class="code" href="interfacersb_1_1rsb__file__mtx__save.html">rsb_file_mtx_save</a>(mtxap,c_null_char)</div><div class="line"></div><div class="line">      <span class="comment">! Structure autotuning:</span></div><div class="line">      istat = <a class="code" href="interfacersb_1_1rsb__tune__spmm.html">rsb_tune_spmm</a>(c_loc(mtxap),c_null_ptr,c_null_ptr,titmax,&amp;</div><div class="line">       &amp; tmax,&amp;</div><div class="line">       &amp; transt,c_loc(alpha),c_null_ptr,nrhs,order,c_loc(x),nr,&amp;</div><div class="line">       &amp; c_loc(beta),c_loc(y),nc)</div><div class="line"></div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>) <span class="keywordflow">GOTO</span> 9997</div><div class="line"></div><div class="line">      <span class="comment">! Thread count autotuning:</span></div><div class="line">      istat = <a class="code" href="interfacersb_1_1rsb__tune__spmm.html">rsb_tune_spmm</a>(c_null_ptr,c_null_ptr,c_loc(ont),titmax,&amp;</div><div class="line">       &amp; tmax,&amp;</div><div class="line">       &amp; transt,c_loc(alpha),mtxap,nrhs,order,c_loc(x),nr,c_loc(beta),&amp;</div><div class="line">       &amp; c_loc(y),nc)</div><div class="line">      print *, <span class="stringliteral">&quot;Optimal number of threads:&quot;</span>, ont</div><div class="line"></div><div class="line">      y(:) = (/3, 3/)<span class="comment">! restoring reference y (rsb_tune_spmm has overwritten it)</span></div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>) <span class="keywordflow">GOTO</span> 9997</div><div class="line">      </div><div class="line">      istat = <a class="code" href="interfacersb_1_1rsb__file__mtx__save.html">rsb_file_mtx_save</a>(mtxap,c_null_char)</div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>) <span class="keywordflow">GOTO</span> 9997</div><div class="line"></div><div class="line">      istat = <a class="code" href="interfacersb_1_1rsb__spmv.html">rsb_spmv</a>(transt,c_loc(alpha),mtxap,c_loc(x),incx,&amp;</div><div class="line">       &amp; c_loc(beta),c_loc(y),incy)</div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>) <span class="keywordflow">GOTO</span> 9997</div><div class="line">      <span class="keywordflow">DO</span> i = 1, 2</div><div class="line">            <span class="keywordflow">IF</span> (y(i).NE.cy(i)) print *, <span class="stringliteral">&quot;type=d dims=2x2 sym=g diag=g &amp;</span></div><div class="line"><span class="stringliteral"></span><span class="stringliteral">      &amp;blocks=1x1 usmv alpha= 3 beta= 1 incx=1 incy=1 trans=n is not ok&quot;</span></div><div class="line">            <span class="keywordflow">IF</span> (y(i).NE.cy(i)) <span class="keywordflow">GOTO</span> 9997</div><div class="line"><span class="keywordflow">      END DO</span></div><div class="line">      print*,<span class="stringliteral">&quot;type=d dims=2x2 sym=g diag=g blocks=1x1 usmv alpha= 3&amp;</span></div><div class="line"><span class="stringliteral"></span><span class="stringliteral">       &amp; beta= 1 incx=1 incy=1 trans=n is ok&quot;</span></div><div class="line"></div><div class="line">      <span class="keywordflow">IF</span> ( res .NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>) <span class="keywordflow">GOTO</span> 9997</div><div class="line">      <span class="keywordflow">GOTO</span> 9998</div><div class="line">9997      res = -1</div><div class="line">9998      <span class="keywordflow">CONTINUE</span></div><div class="line">      mtxap = <a class="code" href="interfacersb_1_1rsb__mtx__free.html">rsb_mtx_free</a>(mtxap)</div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>) res = -1 </div><div class="line"><span class="comment">! 9999      CONTINUE</span></div><div class="line">      errval=<a class="code" href="interfacersb_1_1rsb__lib__exit.html">rsb_lib_exit</a>(eo)                 <span class="comment">! librsb finalization</span></div><div class="line">      <span class="keywordflow">IF</span> (errval.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>)&amp;</div><div class="line">       &amp; stop <span class="stringliteral">&quot;error calling rsb_lib_exit&quot;</span></div><div class="line">      print *, <span class="stringliteral">&quot;rsb module fortran test is ok&quot;</span></div><div class="line"></div><div class="line">      istat = <a class="code" href="interfacersb_1_1rsb__perror.html">rsb_perror</a>(c_null_ptr,istat)</div><div class="line"><span class="keyword">      end SUBROUTINE </span><a class="code" href="fortran__rsb__fi_8F90.html#a81bb92e0655a22d251331911eea093ba">rsb_mod_example1</a></div><div class="line"></div><div class="line"><span class="keyword">      SUBROUTINE </span><a class="code" href="fortran__rsb__fi_8F90.html#ae69a37936a1ca7d8cf7d273b891bc57c">rsb_mod_example2</a>(res)</div><div class="line"><span class="comment">! Example using an unsymmetric matrix specified as COO, and autotuning, built piecewise.</span></div><div class="line">      <span class="keywordtype">USE </span><a class="code" href="namespacersb.html">rsb</a></div><div class="line">      <span class="keywordtype">USE </span>iso_c_binding</div><div class="line">      <span class="keywordtype">IMPLICIT NONE</span></div><div class="line">      <span class="keywordtype">INTEGER</span>,<span class="keywordtype">TARGET</span> :: errval</div><div class="line">      <span class="keywordtype">INTEGER</span> :: res</div><div class="line">      <span class="keywordtype">INTEGER</span> :: transt = <a class="code" href="namespacersb.html#a89c7627f24fecaf23ead8300f671314f">rsb_transposition_n</a>  <span class="comment">! no transposition</span></div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span> :: incx = 1, incb = 1        <span class="comment">! X, B vectors increment</span></div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span>,<span class="keywordtype">TARGET</span> :: alpha = 3,beta = 1</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span> :: nnza = 4, nra = 3, nca = 3     <span class="comment">! nonzeroes, rows, columns of matrix A</span></div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span>,<span class="keywordtype">TARGET</span> :: ia(4) = (/1, 2, 3, 3/)  <span class="comment">! row    indices</span></div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span>,<span class="keywordtype">TARGET</span> :: ja(4) = (/1, 2, 1, 3/)  <span class="comment">! column indices</span></div><div class="line">      <span class="keywordtype">INTEGER(C_SIGNED_CHAR)</span> :: typecode = <a class="code" href="namespacersb.html#af833bb7a31acb188d33424c3c16bd4cd">rsb_numerical_type_double</a></div><div class="line">      <span class="keywordtype">INTEGER</span> :: flags =<a class="code" href="namespacersb.html#a16cc953b0faf8ba964ba79930b51f93c">rsb_flag_default_matrix_flags</a>+<a class="code" href="namespacersb.html#a8325109ecda447aa1e93e8d747673f4c">rsb_flag_symmetric</a></div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span>,<span class="keywordtype">TARGET</span> :: va(4) = (/11.0, 22.0, 13.0, 33.0/) <span class="comment">! coefficients</span></div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span>,<span class="keywordtype">TARGET</span> :: x(3) = (/   0,    0,    0/)</div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span>,<span class="keywordtype">TARGET</span> :: b(3) = (/-1.0, -2.0, -2.0/)</div><div class="line">      <span class="keywordtype">TYPE</span>(c_ptr),<span class="keywordtype">TARGET</span>  :: mtxap = c_null_ptr</div><div class="line">      <span class="keywordtype">TYPE</span>(c_ptr)  :: mtxapp = c_null_ptr</div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span>,<span class="keywordtype">TARGET</span> :: etime = 0.0</div><div class="line">      <span class="comment">!TYPE(C_PTR),PARAMETER :: EO = RSB_NULL_EXIT_OPTIONS</span></div><div class="line">      <span class="comment">!TYPE(C_PTR),PARAMETER :: IO = RSB_NULL_INIT_OPTIONS</span></div><div class="line">      <span class="comment">! Note: using C_NULL_PTR instead of the previous lines because of http://gcc.gnu.org/bugzilla/show_bug.cgi?id=59411</span></div><div class="line">      <span class="keywordtype">TYPE</span>(c_ptr),<span class="keywordtype">PARAMETER</span> :: eo = c_null_ptr</div><div class="line">      <span class="keywordtype">TYPE</span>(c_ptr),<span class="keywordtype">PARAMETER</span> :: io = c_null_ptr</div><div class="line"></div><div class="line">      errval = <a class="code" href="interfacersb_1_1rsb__lib__init.html">rsb_lib_init</a>(io)                <span class="comment">! librsb initialization</span></div><div class="line">      <span class="keywordflow">IF</span> (errval.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>) &amp;</div><div class="line">       &amp; stop <span class="stringliteral">&quot;error calling rsb_lib_init&quot;</span></div><div class="line"><span class="preprocessor">#if defined(__GNUC__) &amp;&amp; (__GNUC__ == 4) &amp;&amp; (__GNUC_MINOR__ &lt; 5)</span></div><div class="line"><span class="preprocessor"></span><span class="preprocessor">#define RSB_SKIP_BECAUSE_OLD_COMPILER 1</span></div><div class="line"><span class="preprocessor"></span><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor"></span><span class="preprocessor">#ifndef RSB_SKIP_BECAUSE_OLD_COMPILER</span></div><div class="line"><span class="preprocessor"></span>      mtxap = <a class="code" href="interfacersb_1_1rsb__mtx__alloc__from__coo__begin.html">rsb_mtx_alloc_from_coo_begin</a>(nnza,typecode,nra,nca,flags,&amp;</div><div class="line">       &amp; c_loc(errval)) <span class="comment">! begin matrix creation</span></div><div class="line">      errval = <a class="code" href="interfacersb_1_1rsb__mtx__set__vals.html">rsb_mtx_set_vals</a>(mtxap,&amp;</div><div class="line">       &amp; c_loc(va),c_loc(ia),c_loc(ja),nnza,flags) <span class="comment">! insert some nonzeroes</span></div><div class="line">      mtxapp = c_loc(mtxap) <span class="comment">! Old compilers like e.g.: Gfortran 4.4.7 will NOT compile this.</span></div><div class="line">      <span class="keywordflow">IF</span> (errval.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>) &amp;</div><div class="line">       &amp; stop <span class="stringliteral">&quot;error calling rsb_mtx_set_vals&quot;</span></div><div class="line">      errval = <a class="code" href="interfacersb_1_1rsb__mtx__alloc__from__coo__end.html">rsb_mtx_alloc_from_coo_end</a>(mtxapp)                   <span class="comment">! end matrix creation</span></div><div class="line">      <span class="keywordflow">IF</span> (errval.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>) &amp;</div><div class="line">       &amp; stop <span class="stringliteral">&quot;error calling rsb_mtx_alloc_from_coo_end&quot;</span></div><div class="line">      errval = <a class="code" href="interfacersb_1_1rsb__spmv.html">rsb_spmv</a>(transt,c_loc(alpha),mtxap,c_loc(x),&amp;</div><div class="line">       &amp; incx,c_loc(beta),c_loc(b),incb) <span class="comment">! X := X + (3) * A * B </span></div><div class="line">      <span class="keywordflow">IF</span> (errval.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>)&amp;</div><div class="line">       &amp; stop <span class="stringliteral">&quot;error calling rsb_spmv&quot;</span></div><div class="line">      mtxap = <a class="code" href="interfacersb_1_1rsb__mtx__free.html">rsb_mtx_free</a>(mtxap)                                 <span class="comment">! destroy matrix</span></div><div class="line"></div><div class="line">      <span class="comment">! The following is optional and depends on configure options, so it is allowed to fail</span></div><div class="line">      errval = <a class="code" href="interfacersb_1_1rsb__lib__get__opt.html">rsb_lib_get_opt</a>(<a class="code" href="namespacersb.html#a565392da24b3006eaeaf5c0d1c5a424d">rsb_io_want_librsb_etime</a>,c_loc(etime))</div><div class="line">      <span class="keywordflow">IF</span> (errval.EQ.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>)&amp;</div><div class="line">       &amp; print*,<span class="stringliteral">&quot;Time spent in librsb is:&quot;</span>,etime</div><div class="line">      <span class="comment">! IF (errval.NE.0)STOP &quot;error calling rsb_lib_get_opt&quot; </span></div><div class="line">      errval = <a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a></div><div class="line"></div><div class="line">      <span class="keywordflow">IF</span> (errval.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>) &amp;</div><div class="line">       &amp; stop <span class="stringliteral">&quot;error calling rsb_mtx_free&quot;</span></div><div class="line"><span class="preprocessor">#else</span></div><div class="line"><span class="preprocessor"></span>      print*,<span class="stringliteral">&quot;You have an old Fortran compiler not supporting C_LOC.&quot;</span></div><div class="line">      print*,<span class="stringliteral">&quot;Skipping a part of the test&quot;</span></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor"></span>      errval=<a class="code" href="interfacersb_1_1rsb__lib__exit.html">rsb_lib_exit</a>(eo)                 <span class="comment">! librsb finalization</span></div><div class="line">      <span class="keywordflow">IF</span> (errval.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>)&amp;</div><div class="line">       &amp; stop <span class="stringliteral">&quot;error calling rsb_lib_exit&quot;</span></div><div class="line">      print *, <span class="stringliteral">&quot;rsb module fortran test is ok&quot;</span></div><div class="line">      res = errval</div><div class="line"><span class="keyword">      end SUBROUTINE </span><a class="code" href="fortran__rsb__fi_8F90.html#ae69a37936a1ca7d8cf7d273b891bc57c">rsb_mod_example2</a></div><div class="line"></div><div class="line"><span class="keyword">      SUBROUTINE </span><a class="code" href="fortran__rsb__fi_8F90.html#ab17498c86a79e053e959b9dab423b8e9">rsb_mod_example3</a>(res)</div><div class="line"><span class="comment">! Example using a symmetric matrix specified as CSR, and autotuning, built at once.</span></div><div class="line">      <span class="keywordtype">USE </span><a class="code" href="namespacersb.html">rsb</a></div><div class="line">      <span class="keywordtype">USE </span>iso_c_binding</div><div class="line">      <span class="keywordtype">IMPLICIT NONE</span></div><div class="line">      <span class="keywordtype">INTEGER</span> ::res</div><div class="line">      <span class="keywordtype">INTEGER</span>,<span class="keywordtype">TARGET</span> :: istat = 0, i</div><div class="line">      <span class="keywordtype">INTEGER</span> :: transt = <a class="code" href="namespacersb.html#a89c7627f24fecaf23ead8300f671314f">rsb_transposition_n</a> <span class="comment">!</span></div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span> :: incx = 1, incy = 1</div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span>,<span class="keywordtype">TARGET</span> :: alpha = 4, beta = 1</div><div class="line"><span class="comment">! 11 21 </span></div><div class="line"><span class="comment">! 21 22 </span></div><div class="line">      <span class="comment">! declaration of VA,IP,JA </span></div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span>, <span class="keywordtype">PARAMETER</span> :: nnz = 3</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span>, <span class="keywordtype">PARAMETER</span> :: nr = 2</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span>, <span class="keywordtype">PARAMETER</span> :: nc = 2</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span>, <span class="keywordtype">PARAMETER</span> :: nrhs = 1</div><div class="line">      <span class="keywordtype">INTEGER</span> :: order = <a class="code" href="namespacersb.html#a8786a38b2ca41b926b8ef6092a55b8a6">rsb_flag_want_column_major_order</a> <span class="comment">! rhs layout</span></div><div class="line">      <span class="keywordtype">INTEGER</span> :: flags = <a class="code" href="namespacersb.html#a65dbcb1d6e6347e5b7e85b5aa49db90c">rsb_flag_noflags</a> + <a class="code" href="namespacersb.html#a8325109ecda447aa1e93e8d747673f4c">rsb_flag_symmetric</a> + &amp;</div><div class="line">       &amp;                 <a class="code" href="namespacersb.html#a8ca3ae90c2f8e0923f80f04e53ad2c37">rsb_flag_fortran_indices_interface</a>        <span class="comment">!  optional flags</span></div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span>,<span class="keywordtype">TARGET</span> :: ip(3) = (/1, 2, 4/)</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span>,<span class="keywordtype">TARGET</span> :: ja(3) = (/1, 1, 2/)</div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span>,<span class="keywordtype">TARGET</span> :: va(3) = (/11,21,22/) <span class="comment">! lower triangle coefficients</span></div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span>,<span class="keywordtype">TARGET</span> :: x(2) = (/1, 2/)<span class="comment">! reference x </span></div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span>,<span class="keywordtype">TARGET</span> :: cy(2) = (/215.0, 264.0/)<span class="comment">! reference cy after </span></div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span>,<span class="keywordtype">TARGET</span> :: y(2) = (/3, 4/)<span class="comment">! y will be overwritten</span></div><div class="line">      <span class="keywordtype">TYPE</span>(c_ptr),<span class="keywordtype">TARGET</span> :: mtxap = c_null_ptr <span class="comment">! matrix pointer</span></div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span> :: tmax = 2.0 <span class="comment">! tuning max time</span></div><div class="line">      <span class="keywordtype">INTEGER</span> :: titmax = 2 <span class="comment">! tuning max iterations</span></div><div class="line">      <span class="keywordtype">INTEGER</span>,<span class="keywordtype">TARGET</span> :: ont = 0     <span class="comment">! optimal number of threads</span></div><div class="line">      <span class="keywordtype">TYPE</span>(c_ptr),<span class="keywordtype">PARAMETER</span> :: eo = c_null_ptr</div><div class="line">      <span class="keywordtype">TYPE</span>(c_ptr),<span class="keywordtype">PARAMETER</span> :: io = c_null_ptr</div><div class="line">      <span class="keywordtype">INTEGER</span>,<span class="keywordtype">TARGET</span> :: errval</div><div class="line"></div><div class="line">      errval = <a class="code" href="interfacersb_1_1rsb__lib__init.html">rsb_lib_init</a>(io)                <span class="comment">! librsb initialization</span></div><div class="line">      <span class="keywordflow">IF</span> (errval.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>) &amp;</div><div class="line">       &amp; stop <span class="stringliteral">&quot;error calling rsb_lib_init&quot;</span></div><div class="line"></div><div class="line">      res = 0</div><div class="line">      mtxap = <a class="code" href="interfacersb_1_1rsb__mtx__alloc__from__csr__const.html">rsb_mtx_alloc_from_csr_const</a>(c_loc(va),c_loc(ip),c_loc(ja)&amp;</div><div class="line">       &amp;,nnz,<a class="code" href="namespacersb.html#af833bb7a31acb188d33424c3c16bd4cd">rsb_numerical_type_double</a>,nr,nc,1,1,flags,c_loc(istat))</div><div class="line"></div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>) <span class="keywordflow">GOTO</span> 9997</div><div class="line"></div><div class="line">      istat = <a class="code" href="interfacersb_1_1rsb__file__mtx__save.html">rsb_file_mtx_save</a>(mtxap,c_null_char)</div><div class="line"></div><div class="line">      <span class="comment">! Structure autotuning:</span></div><div class="line">      istat = <a class="code" href="interfacersb_1_1rsb__tune__spmm.html">rsb_tune_spmm</a>(c_loc(mtxap),c_null_ptr,c_null_ptr,titmax,&amp;</div><div class="line">       &amp; tmax,&amp;</div><div class="line">       &amp; transt,c_loc(alpha),c_null_ptr,nrhs,order,c_loc(x),nr,&amp;</div><div class="line">       &amp; c_loc(beta),c_loc(y),nc)</div><div class="line"></div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>) <span class="keywordflow">GOTO</span> 9997</div><div class="line"></div><div class="line">      <span class="comment">! Thread count autotuning:</span></div><div class="line">      istat = <a class="code" href="interfacersb_1_1rsb__tune__spmm.html">rsb_tune_spmm</a>(c_null_ptr,c_null_ptr,c_loc(ont),titmax,&amp;</div><div class="line">       &amp; tmax,&amp;</div><div class="line">       &amp; transt,c_loc(alpha),mtxap,nrhs,order,c_loc(x),nr,c_loc(beta),&amp;</div><div class="line">       &amp; c_loc(y),nc)</div><div class="line">      print *, <span class="stringliteral">&quot;Optimal number of threads:&quot;</span>, ont</div><div class="line"></div><div class="line">      y(:) = (/3, 4/)<span class="comment">! restoring reference y (rsb_tune_spmm has overwritten it)</span></div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>) <span class="keywordflow">GOTO</span> 9997</div><div class="line">      </div><div class="line">      istat = <a class="code" href="interfacersb_1_1rsb__file__mtx__save.html">rsb_file_mtx_save</a>(mtxap,c_null_char)</div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>) <span class="keywordflow">GOTO</span> 9997</div><div class="line"></div><div class="line">      istat = <a class="code" href="interfacersb_1_1rsb__spmv.html">rsb_spmv</a>(transt,c_loc(alpha),mtxap,c_loc(x),incx,&amp;</div><div class="line">       &amp; c_loc(beta),c_loc(y),incy)</div><div class="line">      print *, y</div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>) <span class="keywordflow">GOTO</span> 9997</div><div class="line">      <span class="keywordflow">DO</span> i = 1, 2</div><div class="line">            <span class="keywordflow">IF</span> (y(i).NE.cy(i)) print *, <span class="stringliteral">&quot;type=d dims=2x2 sym=s diag=g &amp;</span></div><div class="line"><span class="stringliteral"></span><span class="stringliteral">      &amp;blocks=1x1 usmv alpha= 4 beta= 1 incx=1 incy=1 trans=n is not ok&quot;</span></div><div class="line">            <span class="keywordflow">IF</span> (y(i).NE.cy(i)) <span class="keywordflow">GOTO</span> 9997</div><div class="line"><span class="keywordflow">      END DO</span></div><div class="line">      print*,<span class="stringliteral">&quot;type=d dims=2x2 sym=s diag=g blocks=1x1 usmv alpha= 4&amp;</span></div><div class="line"><span class="stringliteral"></span><span class="stringliteral">       &amp; beta= 1 incx=1 incy=1 trans=n is ok&quot;</span></div><div class="line">      <span class="keywordflow">GOTO</span> 9998</div><div class="line"></div><div class="line">      errval=<a class="code" href="interfacersb_1_1rsb__lib__exit.html">rsb_lib_exit</a>(eo)                 <span class="comment">! librsb finalization</span></div><div class="line">      <span class="keywordflow">IF</span> (errval.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>)&amp;</div><div class="line">       &amp; stop <span class="stringliteral">&quot;error calling rsb_lib_exit&quot;</span></div><div class="line">      print *, <span class="stringliteral">&quot;rsb module fortran test is ok&quot;</span></div><div class="line">9997      res = -1</div><div class="line">9998      <span class="keywordflow">CONTINUE</span></div><div class="line">      mtxap = <a class="code" href="interfacersb_1_1rsb__mtx__free.html">rsb_mtx_free</a>(mtxap)</div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.<a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>) res = -1 </div><div class="line"><span class="comment">! 9999      CONTINUE</span></div><div class="line">      istat = <a class="code" href="interfacersb_1_1rsb__perror.html">rsb_perror</a>(c_null_ptr,istat)</div><div class="line"><span class="keyword">      end SUBROUTINE </span><a class="code" href="fortran__rsb__fi_8F90.html#ab17498c86a79e053e959b9dab423b8e9">rsb_mod_example3</a></div><div class="line"></div><div class="line">      <span class="keyword">PROGRAM</span> <a class="code" href="assemble_8cpp.html#a8216c1645620cdb2f629cde3ac02ffef">main</a></div><div class="line">      <span class="keywordtype">USE </span><a class="code" href="namespacersb.html">rsb</a></div><div class="line">      <span class="keywordtype">IMPLICIT NONE</span></div><div class="line">      <span class="keywordtype">INTEGER</span> :: res = <a class="code" href="namespacersb.html#a2f418e43e861a006b5aea1d55913fee2">rsb_err_no_error</a>, passed = 0, failed = 0</div><div class="line"></div><div class="line">      <span class="keyword">CALL </span><a class="code" href="fortran__rsb__fi_8F90.html#a81bb92e0655a22d251331911eea093ba">rsb_mod_example1</a>(res)</div><div class="line">      <span class="keywordflow">IF</span> (res.LT.0) failed = failed + 1</div><div class="line">      <span class="keywordflow">IF</span> (res.EQ.0) passed = passed + 1</div><div class="line"></div><div class="line">      <span class="keyword">CALL </span><a class="code" href="fortran__rsb__fi_8F90.html#ae69a37936a1ca7d8cf7d273b891bc57c">rsb_mod_example2</a>(res)</div><div class="line">      <span class="keywordflow">IF</span> (res.LT.0) failed = failed + 1</div><div class="line">      <span class="keywordflow">IF</span> (res.EQ.0) passed = passed + 1</div><div class="line"></div><div class="line">      <span class="keyword">CALL </span><a class="code" href="fortran__rsb__fi_8F90.html#ab17498c86a79e053e959b9dab423b8e9">rsb_mod_example3</a>(res)</div><div class="line">      <span class="keywordflow">IF</span> (res.LT.0) failed = failed + 1</div><div class="line">      <span class="keywordflow">IF</span> (res.EQ.0) passed = passed + 1</div><div class="line">      </div><div class="line">      print *, <span class="stringliteral">&quot;FAILED:&quot;</span>, failed</div><div class="line">      print *, <span class="stringliteral">&quot;PASSED:&quot;</span>, passed</div><div class="line">      <span class="keywordflow">IF</span> (failed.GT.0) <span class="keywordflow">THEN</span></div><div class="line">       stop 1</div><div class="line"><span class="keywordflow">      END IF</span></div><div class="line"><span class="keyword">      END PROGRAM</span></div><div class="line"></div></div><!-- fragment --> </div><h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="a8ec2266d83cd6c0b762cbcbc92c0af3d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ec2266d83cd6c0b762cbcbc92c0af3d">&#9670;&nbsp;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">program main </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a81bb92e0655a22d251331911eea093ba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a81bb92e0655a22d251331911eea093ba">&#9670;&nbsp;</a></span>rsb_mod_example1()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine rsb_mod_example1 </td>
          <td>(</td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>res</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ae69a37936a1ca7d8cf7d273b891bc57c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae69a37936a1ca7d8cf7d273b891bc57c">&#9670;&nbsp;</a></span>rsb_mod_example2()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine rsb_mod_example2 </td>
          <td>(</td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>res</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ab17498c86a79e053e959b9dab423b8e9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab17498c86a79e053e959b9dab423b8e9">&#9670;&nbsp;</a></span>rsb_mod_example3()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine rsb_mod_example3 </td>
          <td>(</td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>res</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
