<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>librsb: examples/fortran.F90 File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">librsb
   &#160;<span id="projectnumber">1.3.0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d28a4824dc47e487b107a5db32ef43c4.html">examples</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">fortran.F90 File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Sparse BLAS-based usage: uscr_begin(), <a class="el" href="namespaceblas__sparse.html#a1e0eb1ccd8ffbf49baefe455a248f7fe" title="Get a matrix property. ">usgp()</a>, <a class="el" href="namespaceblas__sparse.html#a469df92a4d25a9554fb1d79cdac1de84" title="Set a matrix property. Should be called just after creation, before nonzeroes insertion. ">ussp()</a>, usmv(), ...  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:a9e8daa274f041cb50f75d64028e079ba"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fortran_8F90.html#a9e8daa274f041cb50f75d64028e079ba">blas_sparse_mod_example</a> (res)</td></tr>
<tr class="separator:a9e8daa274f041cb50f75d64028e079ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5afdd9925e3262966d4dde1fed40cca8"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fortran_8F90.html#a5afdd9925e3262966d4dde1fed40cca8">blas_sparse_io_example</a> (res)</td></tr>
<tr class="separator:a5afdd9925e3262966d4dde1fed40cca8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ec2266d83cd6c0b762cbcbc92c0af3d"><td class="memItemLeft" align="right" valign="top">program&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fortran_8F90.html#a8ec2266d83cd6c0b762cbcbc92c0af3d">main</a></td></tr>
<tr class="separator:a8ec2266d83cd6c0b762cbcbc92c0af3d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Sparse BLAS-based usage: uscr_begin(), <a class="el" href="namespaceblas__sparse.html#a1e0eb1ccd8ffbf49baefe455a248f7fe" title="Get a matrix property. ">usgp()</a>, <a class="el" href="namespaceblas__sparse.html#a469df92a4d25a9554fb1d79cdac1de84" title="Set a matrix property. Should be called just after creation, before nonzeroes insertion. ">ussp()</a>, usmv(), ... </p>
<div class="fragment"><div class="line"><span class="comment">! </span></div><div class="line"><span class="comment">! Copyright (C) 2008-2022 Michele Martone</span></div><div class="line"><span class="comment">! </span></div><div class="line"><span class="comment">! This file is part of librsb.</span></div><div class="line"><span class="comment">! </span></div><div class="line"><span class="comment">! librsb is free software; you can redistribute it and/or modify it</span></div><div class="line"><span class="comment">! under the terms of the GNU Lesser General Public License as published</span></div><div class="line"><span class="comment">! by the Free Software Foundation; either version 3 of the License, or</span></div><div class="line"><span class="comment">! (at your option) any later version.</span></div><div class="line"><span class="comment">! </span></div><div class="line"><span class="comment">! librsb is distributed in the hope that it will be useful, but WITHOUT</span></div><div class="line"><span class="comment">! ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span></div><div class="line"><span class="comment">! FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public</span></div><div class="line"><span class="comment">! License for more details.</span></div><div class="line"><span class="comment">! </span></div><div class="line"><span class="comment">! You should have received a copy of the GNU Lesser General Public</span></div><div class="line"><span class="comment">! License along with librsb; see the file COPYING.</span></div><div class="line"><span class="comment">! If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div><div class="line"><span class="comment">! </span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">!&gt; @file</span></div><div class="line"><span class="comment">!! @brief Sparse BLAS-based usage:</span></div><div class="line"><span class="comment">!!  uscr_begin(), usgp(), ussp(), usmv(), ...</span></div><div class="line"><span class="comment">!! \include fortran.F90</span></div><div class="line"></div><div class="line"><span class="keyword">      SUBROUTINE </span><a class="code" href="fortran_8F90.html#a9e8daa274f041cb50f75d64028e079ba">blas_sparse_mod_example</a>(res)</div><div class="line">      <span class="keywordtype">USE </span><a class="code" href="namespaceblas__sparse.html">blas_sparse</a></div><div class="line">      <span class="keywordtype">USE </span><a class="code" href="namespacersb.html">rsb</a> <span class="comment">! For the second part of the example and RSB_IDX_KIND</span></div><div class="line">      <span class="keywordtype">USE </span>iso_c_binding</div><div class="line">      <span class="keywordtype">IMPLICIT NONE</span></div><div class="line">      <span class="keywordtype">INTEGER</span> :: i, j</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_BLAS_IDX_KIND)</span> :: istat = 0, res</div><div class="line">      <span class="keywordtype">TYPE</span>(c_ptr),<span class="keywordtype">TARGET</span> :: mtxap = c_null_ptr <span class="comment">! matrix pointer</span></div><div class="line">      <span class="keywordtype">INTEGER</span> :: a</div><div class="line">      <span class="keywordtype">INTEGER</span>,<span class="keywordtype">PARAMETER</span> :: transn = <a class="code" href="blas__sparse_8h.html#a23e5e138364c80074ac014a3dfd346b7a60c827bef60beeea296c26486e28d85f">blas_no_trans</a></div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span>,<span class="keywordtype">PARAMETER</span> :: incx = 1</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span>,<span class="keywordtype">PARAMETER</span> :: incy = 1</div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span>,<span class="keywordtype">PARAMETER</span> :: alpha = 3</div><div class="line"><span class="comment">! Symmetric (declared via lower triangle) matrix based example, e.g.:</span></div><div class="line"><span class="comment">! 1 0</span></div><div class="line"><span class="comment">! 1 1</span></div><div class="line">      <span class="comment">! declaration of VA,IA,JA </span></div><div class="line">      <span class="comment">!INTEGER,PARAMETER :: nr = 100</span></div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span>,<span class="keywordtype">PARAMETER</span> :: nr = 20</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span>,<span class="keywordtype">PARAMETER</span> :: nc = nr</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span>,<span class="keywordtype">PARAMETER</span> :: nnz = (nr*(nr+1))/2 <span class="comment">! half the square</span></div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span>,<span class="keywordtype">PARAMETER</span> :: nrhs = 1</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span> :: nt = 0</div><div class="line">      <span class="keywordtype">INTEGER</span> :: ic, ir</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span>,<span class="keywordtype">PARAMETER</span> :: ia(nnz) = (/ (((ir), ic=1,ir), ir=1,nr ) /) <span class="comment">! (/1, 2, 2/)</span></div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span>,<span class="keywordtype">PARAMETER</span> :: ja(nnz) = (/ (((ic), ic=1,ir), ir=1,nr ) /) <span class="comment">! (/1, 1, 2/)</span></div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span>,<span class="keywordtype">PARAMETER</span> :: va(nnz) = (/ ((1, ic=1,ir), ir=1,nr ) /) <span class="comment">! (/1, 1, 1/)</span></div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span> :: x(nc,nrhs) = reshape((/((1), ic=1,nc*nrhs)/),[nc,nrhs]) <span class="comment">! reference x ! (/1, 1/)</span></div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span>,<span class="keywordtype">PARAMETER</span> :: cy(nr,nrhs) = reshape((/((alpha+alpha*nr), ir=1,nr*nrhs)/),[nr,nrhs]) <span class="comment">! reference cy after ! (/9, 9/)</span></div><div class="line">      <span class="keywordtype">REAL(KIND=8)</span> :: y(nr,nrhs) = reshape((/((alpha), ir=1,nr*nrhs)/),[nr,nrhs]) <span class="comment">! y will be overwritten ! (/3, 3/)</span></div><div class="line">      <span class="comment">! First example part: pure blas_sparse code.</span></div><div class="line">      res = 0</div><div class="line">      <span class="keyword">CALL </span><a class="code" href="namespaceblas__sparse.html#acf14608f8b0375ca133b7f850bde3b50">duscr_begin</a>(nr,nc,a,res)</div><div class="line">      <span class="keywordflow">IF</span> (res.NE.0) <span class="keywordflow">GOTO</span> 9999</div><div class="line">      <span class="keyword">CALL </span><a class="code" href="namespaceblas__sparse.html#a469df92a4d25a9554fb1d79cdac1de84">ussp</a>(a,<a class="code" href="blas__sparse_8h.html#a7da08ccc1c4c7f5ff40768d502a6e63baba96b7c19a0ccfe3be9d78cb27690487">blas_lower_symmetric</a>,istat)</div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.0) <span class="keywordflow">GOTO</span> 9997</div><div class="line">      <span class="keyword">CALL </span><a class="code" href="namespaceblas__sparse.html#a469df92a4d25a9554fb1d79cdac1de84">ussp</a>(a,<a class="code" href="blas__sparse_8h.html#aee94244609acd12511418bfbf0a77729ae05ed12240987c33f90ee6cf012985a0">blas_rsb_spmv_autotuning_on</a>,istat) <span class="comment">! (experimental) turns auto-tuning + thread setting on</span></div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.0) print *,<span class="stringliteral">&quot;autotuning returned nonzero:&quot;</span>, istat &amp;</div><div class="line">       &amp;,<span class="stringliteral">&quot; ...did you enable autotuning ?&quot;</span></div><div class="line">      <span class="comment">!</span></div><div class="line">      <span class="comment">! First style example </span></div><div class="line">      <span class="keyword">CALL </span><a class="code" href="interfaceblas__sparse_1_1uscr__insert__entries.html">uscr_insert_entries</a>(a,nnz,va,ia,ja,istat)</div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.0) <span class="keywordflow">GOTO</span> 9997</div><div class="line">      <span class="keyword">CALL </span><a class="code" href="namespaceblas__sparse.html#a48f1e1b82322910d45a1b2455421745f">uscr_end</a>(a,istat)</div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.0) <span class="keywordflow">GOTO</span> 9997</div><div class="line">      <span class="comment">! CALL ussp(A,blas_rsb_duplicates_sum,istat)</span></div><div class="line">      <span class="comment">! CALL uscr_insert_entries(A,nnz,VA,IA,JA,istat) ! uncomment this to activate add of coefficients to pattern</span></div><div class="line">      <span class="keyword">CALL </span><a class="code" href="namespaceblas__sparse.html#a1e0eb1ccd8ffbf49baefe455a248f7fe">usgp</a>(a,<a class="code" href="blas__sparse_8h.html#aee94244609acd12511418bfbf0a77729ae05ed12240987c33f90ee6cf012985a0">blas_rsb_spmv_autotuning_on</a>,nt)  <span class="comment">! (experimental)</span></div><div class="line">      <span class="keywordflow">IF</span> (nt.NE.0) print*,<span class="stringliteral">&quot;autotuner chose &quot;</span>,nt,<span class="stringliteral">&quot; threads&quot;</span></div><div class="line">      <span class="keyword">CALL </span><a class="code" href="namespaceblas__sparse.html#a469df92a4d25a9554fb1d79cdac1de84">ussp</a>(a,<a class="code" href="blas__sparse_8h.html#aee94244609acd12511418bfbf0a77729addbb7f37e0069794e22567ce9c58a1a7">blas_rsb_spmv_autotuning_off</a>,istat) <span class="comment">! (experimental) turns auto-tuning + thread setting off</span></div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.0) <span class="keywordflow">GOTO</span> 9997</div><div class="line"></div><div class="line">      <span class="keywordflow">DO</span> j = 1, nrhs</div><div class="line">        <span class="keyword">CALL </span><a class="code" href="interfaceblas__sparse_1_1usmv.html">usmv</a>(transn,alpha,a,x(:,j),incx,y(:,j),incy,istat)</div><div class="line"><span class="keywordflow">      END DO</span></div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.0) <span class="keywordflow">GOTO</span> 9997</div><div class="line">      <span class="comment">!</span></div><div class="line">      <span class="keywordflow">DO</span> j = 1, nrhs</div><div class="line">      <span class="keywordflow">DO</span> i = 1, nr</div><div class="line">        <span class="keywordflow">IF</span> (y(i,j).NE.cy(i,j)) print *, <span class="stringliteral">&quot;first check results are not ok&quot;</span></div><div class="line">        <span class="keywordflow">IF</span> (y(i,j).NE.cy(i,j)) <span class="keywordflow">GOTO</span> 9997</div><div class="line"><span class="keywordflow">      END DO</span></div><div class="line"><span class="keywordflow">      END DO</span></div><div class="line">      <span class="comment">!</span></div><div class="line">      y(:,:) = alpha <span class="comment">! reset</span></div><div class="line">      <span class="comment">!</span></div><div class="line">      <span class="comment">! Second style example </span></div><div class="line">      <span class="keyword">CALL </span><a class="code" href="namespaceblas__sparse.html#a469df92a4d25a9554fb1d79cdac1de84">ussp</a>(a,<a class="code" href="blas__sparse_8h.html#aee94244609acd12511418bfbf0a77729ac88f907f61c86a61837a37274e2f97d4">blas_rsb_autotune_next_operation</a>,istat) <span class="comment">! (experimental) turns auto-tuning + thread setting on</span></div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.0) <span class="keywordflow">GOTO</span> 9997</div><div class="line">      <span class="keywordflow">DO</span> j = 1, nrhs</div><div class="line">        <span class="keyword">CALL </span><a class="code" href="interfaceblas__sparse_1_1usmv.html">usmv</a>(transn,alpha,a,x(:,j),incx,y(:,j),incy,istat)</div><div class="line"><span class="keywordflow">      END DO</span></div><div class="line">      <span class="keyword">CALL </span><a class="code" href="interfaceblas__sparse_1_1usmm.html">usmm</a>(<a class="code" href="blas__sparse_8h.html#a9e6ec9e515f9d9b7e47110ae5f6ea04ea69ab6bcac9a135e7321dc4ca72616d1e">blas_colmajor</a>,transn,nrhs, alpha,a,x,nr,y,nc,istat) <span class="comment">! Equivalent to the above (as long as incx=incy=1).</span></div><div class="line">      <span class="keyword">CALL </span><a class="code" href="interfaceblas__sparse_1_1usmm.html">usmm</a>(<a class="code" href="blas__sparse_8h.html#a9e6ec9e515f9d9b7e47110ae5f6ea04ea69ab6bcac9a135e7321dc4ca72616d1e">blas_colmajor</a>,transn,nrhs,-alpha,a,x,nr,y,nc,istat) <span class="comment">! Subtract the last usmm call contribution.</span></div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.0) <span class="keywordflow">GOTO</span> 9997</div><div class="line">      <span class="comment">!</span></div><div class="line">      <span class="keywordflow">DO</span> j = 1, nrhs</div><div class="line">      <span class="keywordflow">DO</span> i = 1, nr</div><div class="line">        <span class="keywordflow">IF</span> (y(i,j).NE.cy(i,j)) print *,<span class="stringliteral">&quot;second check results are not ok&quot;</span></div><div class="line">        <span class="keywordflow">IF</span> (y(i,j).NE.cy(i,j)) <span class="keywordflow">GOTO</span> 9997</div><div class="line"><span class="keywordflow">      END DO</span></div><div class="line"><span class="keywordflow">      END DO</span></div><div class="line">      <span class="comment">!</span></div><div class="line">      print *, <span class="stringliteral">&quot;check results are ok&quot;</span></div><div class="line">      </div><div class="line">      <span class="comment">! Second part of the example: access to the rsb.h interface via</span></div><div class="line">      <span class="comment">! the ISO C Binding interface.</span></div><div class="line">      mtxap = <a class="code" href="interfaceblas__sparse_1_1rsb__blas__get__mtx.html">rsb_blas_get_mtx</a>(a) <span class="comment">! get pointer to rsb structure (as in the rsb.h API)</span></div><div class="line">      <span class="keywordflow">IF</span>(nr.LT.5) istat = <a class="code" href="interfacersb_1_1rsb__file__mtx__save.html">rsb_file_mtx_save</a>(mtxap,c_null_char) <span class="comment">! write to stdout (only if matrix small enough)</span></div><div class="line"></div><div class="line">      <span class="keywordflow">GOTO</span> 9998</div><div class="line">9997      res = -1</div><div class="line">9998      <span class="keywordflow">CONTINUE</span></div><div class="line">      <span class="keyword">CALL </span><a class="code" href="namespaceblas__sparse.html#a8a3b6cd055048ab5e15b1b18be291f32">usds</a>(a,istat)</div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.0) res = -1</div><div class="line">9999      <span class="keywordflow">CONTINUE</span></div><div class="line"><span class="keyword">      end SUBROUTINE </span><a class="code" href="fortran_8F90.html#a9e8daa274f041cb50f75d64028e079ba">blas_sparse_mod_example</a></div><div class="line"></div><div class="line">      <span class="comment">! Example loading a matrix from file and measuring SPMM.</span></div><div class="line"><span class="keyword">      SUBROUTINE </span><a class="code" href="fortran_8F90.html#a5afdd9925e3262966d4dde1fed40cca8">blas_sparse_io_example</a>(res)</div><div class="line">      <span class="keywordtype">USE </span><a class="code" href="namespaceblas__sparse.html">blas_sparse</a></div><div class="line">      <span class="keywordtype">USE </span><a class="code" href="namespacersb.html">rsb</a> <span class="comment">! For rsb_blas_file_mtx_load</span></div><div class="line">      <span class="keywordtype">USE </span>iso_c_binding</div><div class="line">      <span class="keywordtype">IMPLICIT NONE</span></div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span> :: res <span class="comment">! note: same as RSB_BLAS_IDX_KIND</span></div><div class="line">      <span class="keywordtype">INTEGER</span> :: j</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_BLAS_IDX_KIND)</span> :: istat = 0</div><div class="line">      <span class="keywordtype">INTEGER</span> :: a</div><div class="line">      <span class="keywordtype">INTEGER</span>,<span class="keywordtype">PARAMETER</span> :: transn = <a class="code" href="blas__sparse_8h.html#a23e5e138364c80074ac014a3dfd346b7a60c827bef60beeea296c26486e28d85f">blas_no_trans</a></div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span>,<span class="keywordtype">PARAMETER</span> :: incx = 1</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span>,<span class="keywordtype">PARAMETER</span> :: incy = 1</div><div class="line">      <span class="keywordtype">COMPLEX(KIND=8)</span>,<span class="keywordtype">PARAMETER</span> :: alpha = 3</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span> :: nr</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span> :: nc</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span> :: nz</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span> :: st</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span>,<span class="keywordtype">PARAMETER</span> :: nrhs = 4</div><div class="line">      <span class="keywordtype">COMPLEX(KIND=8)</span>, <span class="keywordtype">ALLOCATABLE</span>, <span class="keywordtype">TARGET</span>, <span class="keywordtype">DIMENSION(:,:)</span> :: x</div><div class="line">      <span class="keywordtype">COMPLEX(KIND=8)</span>, <span class="keywordtype">ALLOCATABLE</span>, <span class="keywordtype">TARGET</span>, <span class="keywordtype">DIMENSION(:,:)</span> :: y</div><div class="line">      <span class="keywordtype">CHARACTER(KIND=C_CHAR,LEN=7)</span>,<span class="keywordtype">TARGET</span> :: filename = <span class="stringliteral">&#39;pd.mtx&#39;</span>//c_null_char</div><div class="line">      <span class="keywordtype">INTEGER(C_SIGNED_CHAR)</span> :: typecode = <a class="code" href="namespacersb.html#a1865b95dcc4fac4f0fe21dfe8c4ef036">rsb_numerical_type_double_complex</a></div><div class="line">      <span class="keywordtype">REAL(KIND=C_DOUBLE)</span> :: mvt,mmt,omt</div><div class="line">      <span class="keywordtype">INTEGER(KIND=C_INT)</span>,<span class="keywordtype">TARGET</span>::izero=0</div><div class="line"></div><div class="line">      res = 0</div><div class="line"></div><div class="line">      a = <a class="code" href="interfacersb_1_1rsb__blas__file__mtx__load.html">rsb_blas_file_mtx_load</a>(filename, typecode);</div><div class="line">      <span class="keywordflow">IF</span> (a.EQ.<a class="code" href="blas__sparse_8h.html#a7cb10fb1b47b79ef278d6f09d571bd06a51022d3d696b9aee38d51040a5b01da7">blas_invalid_handle</a>) <span class="keywordflow">GOTO</span> 9997</div><div class="line"></div><div class="line">      <span class="keyword">CALL </span><a class="code" href="namespaceblas__sparse.html#a1e0eb1ccd8ffbf49baefe455a248f7fe">usgp</a>(a,<a class="code" href="blas__sparse_8h.html#a540f6a907f9f5e49d84a65c530e598c6ace8432d9075d2530ffc0b474c5560e23">blas_num_rows</a>,nr)</div><div class="line">      <span class="keyword">CALL </span><a class="code" href="namespaceblas__sparse.html#a1e0eb1ccd8ffbf49baefe455a248f7fe">usgp</a>(a,<a class="code" href="blas__sparse_8h.html#a540f6a907f9f5e49d84a65c530e598c6a9b8cd10d952e1405feeac4f81e3b9f4b">blas_num_cols</a>,nc)</div><div class="line">      <span class="keyword">CALL </span><a class="code" href="namespaceblas__sparse.html#a1e0eb1ccd8ffbf49baefe455a248f7fe">usgp</a>(a,<a class="code" href="blas__sparse_8h.html#a540f6a907f9f5e49d84a65c530e598c6a1968168c04860e3bb4ed8eb3232084fd">blas_num_nonzeros</a>,nz)</div><div class="line"></div><div class="line">      print*,<span class="stringliteral">&quot;Read matrix &quot;</span>,filename(1:6),<span class="stringliteral">&quot; &quot;</span>,nr,<span class="stringliteral">&quot;x&quot;</span>,nc,<span class="stringliteral">&quot;:&quot;</span>,nz</div><div class="line">      <span class="keyword">CALL </span><a class="code" href="namespaceblas__sparse.html#a1e0eb1ccd8ffbf49baefe455a248f7fe">usgp</a>(a,<a class="code" href="blas__sparse_8h.html#a7da08ccc1c4c7f5ff40768d502a6e63bab56e7dc16e197ab01f48a53c3f866866">blas_general</a>,st)</div><div class="line">      <span class="keywordflow">IF</span> (st .EQ. 1) print*,<span class="stringliteral">&quot;Matrix has no symmetry&quot;</span></div><div class="line">      <span class="keyword">CALL </span><a class="code" href="namespaceblas__sparse.html#a1e0eb1ccd8ffbf49baefe455a248f7fe">usgp</a>(a,<a class="code" href="blas__sparse_8h.html#a7da08ccc1c4c7f5ff40768d502a6e63ba2ac709e94a120358c4bbd620ec8888de">blas_upper_symmetric</a>,st)</div><div class="line">      <span class="keywordflow">IF</span> (st .EQ. 1) print*,<span class="stringliteral">&quot;Matrix is upper symmetric&quot;</span></div><div class="line">      <span class="keyword">CALL </span><a class="code" href="namespaceblas__sparse.html#a1e0eb1ccd8ffbf49baefe455a248f7fe">usgp</a>(a,<a class="code" href="blas__sparse_8h.html#a7da08ccc1c4c7f5ff40768d502a6e63ba5377bb47a85d04c507e8883f8c17d1fe">blas_upper_hermitian</a>,st)</div><div class="line">      <span class="keywordflow">IF</span> (st .EQ. 1) print*,<span class="stringliteral">&quot;Matrix is upper hermitian&quot;</span></div><div class="line">      <span class="comment">! ...</span></div><div class="line"></div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.0) <span class="keywordflow">GOTO</span> 9997</div><div class="line">      <span class="keyword">WRITE</span>(*,<span class="stringliteral">&#39;(a,i0)&#39;</span>) <span class="stringliteral">&quot;Using NRHS=&quot;</span>,nrhs</div><div class="line">      <span class="keyword">ALLOCATE</span>( x(nc,nrhs))</div><div class="line">      <span class="keyword">ALLOCATE</span>( y(nr,nrhs))</div><div class="line">      x = 1.0</div><div class="line"></div><div class="line">      y = 0.0</div><div class="line">      mvt = -<a class="code" href="interfacersb_1_1rsb__time.html">rsb_time</a>()</div><div class="line">      <span class="keywordflow">DO</span> j = 1, nrhs</div><div class="line">        <span class="keyword">CALL </span><a class="code" href="interfaceblas__sparse_1_1usmv.html">usmv</a>(transn,alpha,a,x(:,j),incx,y(:,j),incy,istat)</div><div class="line"><span class="keywordflow">      END DO</span></div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.0) <span class="keywordflow">GOTO</span> 9997</div><div class="line">      mvt = mvt + <a class="code" href="interfacersb_1_1rsb__time.html">rsb_time</a>()</div><div class="line">      <span class="keyword">WRITE</span>(*,<span class="stringliteral">&#39;(a,e12.4,a)&#39;</span>) <span class="stringliteral">&quot;Repeated USMV took &quot;</span>,mvt,<span class="stringliteral">&quot; s&quot;</span></div><div class="line">      </div><div class="line">      y = 0.0</div><div class="line">      mmt = -<a class="code" href="interfacersb_1_1rsb__time.html">rsb_time</a>()</div><div class="line">      <span class="keyword">CALL </span><a class="code" href="interfaceblas__sparse_1_1usmm.html">usmm</a>(<a class="code" href="blas__sparse_8h.html#a9e6ec9e515f9d9b7e47110ae5f6ea04ea69ab6bcac9a135e7321dc4ca72616d1e">blas_colmajor</a>,transn,nrhs, alpha,a,x,nr,y,nc,istat)</div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.0) <span class="keywordflow">GOTO</span> 9997</div><div class="line">      mmt = mmt + <a class="code" href="interfacersb_1_1rsb__time.html">rsb_time</a>()</div><div class="line">      <span class="keyword">WRITE</span>(*,<span class="stringliteral">&#39;(a,e12.4,a)&#39;</span>) <span class="stringliteral">&quot;A single USMM took &quot;</span>,mmt,<span class="stringliteral">&quot; s&quot;</span></div><div class="line"></div><div class="line">      <span class="keyword">WRITE</span>(*,<span class="stringliteral">&#39;(a,g11.4,a)&#39;</span>)<span class="stringliteral">&quot;USMM-to-USMV speed ratio is is &quot;</span>, mvt/mmt, <span class="stringliteral">&quot;x&quot;</span></div><div class="line"></div><div class="line">      print*,<span class="stringliteral">&quot;Call auto-tuning routine..&quot;</span></div><div class="line">      <span class="comment">! Change IZERO value to 1 to get verbose tuning again.</span></div><div class="line">      res = <a class="code" href="interfacersb_1_1rsb__lib__set__opt.html">rsb_lib_set_opt</a>(<a class="code" href="namespacersb.html#ac95404408be9bc2045e8455881d21377">rsb_io_want_verbose_tuning</a>,c_loc(izero))</div><div class="line">      <span class="keywordflow">IF</span> (res.NE.0) <span class="keywordflow">GOTO</span> 9997</div><div class="line">      <span class="keyword">CALL </span><a class="code" href="namespaceblas__sparse.html#a469df92a4d25a9554fb1d79cdac1de84">ussp</a>(a,<a class="code" href="blas__sparse_8h.html#aee94244609acd12511418bfbf0a77729ac88f907f61c86a61837a37274e2f97d4">blas_rsb_autotune_next_operation</a>,istat) <span class="comment">! (experimental) turns auto-tuning + thread setting on</span></div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.0) <span class="keywordflow">GOTO</span> 9997</div><div class="line">      <span class="keyword">CALL </span><a class="code" href="interfaceblas__sparse_1_1usmm.html">usmm</a>(<a class="code" href="blas__sparse_8h.html#a9e6ec9e515f9d9b7e47110ae5f6ea04ea69ab6bcac9a135e7321dc4ca72616d1e">blas_colmajor</a>,transn,nrhs, alpha,a,x,nr,y,nc,istat)</div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.0) <span class="keywordflow">GOTO</span> 9997</div><div class="line"></div><div class="line">      print*,<span class="stringliteral">&quot;Repeat measurement.&quot;</span></div><div class="line">      y = 0.0</div><div class="line">      omt = -<a class="code" href="interfacersb_1_1rsb__time.html">rsb_time</a>()</div><div class="line">      <span class="keyword">CALL </span><a class="code" href="interfaceblas__sparse_1_1usmm.html">usmm</a>(<a class="code" href="blas__sparse_8h.html#a9e6ec9e515f9d9b7e47110ae5f6ea04ea69ab6bcac9a135e7321dc4ca72616d1e">blas_colmajor</a>,transn,nrhs, alpha,a,x,nr,y,nc,istat)</div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.0) <span class="keywordflow">GOTO</span> 9997</div><div class="line">      omt = omt + <a class="code" href="interfacersb_1_1rsb__time.html">rsb_time</a>()</div><div class="line">      <span class="keyword">WRITE</span>(*,<span class="stringliteral">&#39;(a,e12.4,a)&#39;</span>) <span class="stringliteral">&quot;Tuned USMM took &quot;</span>,omt,<span class="stringliteral">&quot; s&quot;</span></div><div class="line">      <span class="keyword">WRITE</span>(*,<span class="stringliteral">&#39;(a,g11.4,a)&#39;</span>)<span class="stringliteral">&quot;Tuned-to-untuned speed ratio is is &quot;</span>,mmt/omt,<span class="stringliteral">&quot;x&quot;</span></div><div class="line">      </div><div class="line">      <span class="keywordflow">GOTO</span> 9998</div><div class="line">9997      res = -1</div><div class="line">9998      <span class="keywordflow">CONTINUE</span></div><div class="line">      <span class="keyword">CALL </span><a class="code" href="namespaceblas__sparse.html#a8a3b6cd055048ab5e15b1b18be291f32">usds</a>(a,istat)</div><div class="line">      <span class="keywordflow">IF</span> (istat.NE.0) res = -1</div><div class="line"><span class="keyword">      end SUBROUTINE </span><a class="code" href="fortran_8F90.html#a5afdd9925e3262966d4dde1fed40cca8">blas_sparse_io_example</a></div><div class="line"></div><div class="line">      <span class="keyword">PROGRAM</span> <a class="code" href="assemble_8cpp.html#a8216c1645620cdb2f629cde3ac02ffef">main</a></div><div class="line">      <span class="keywordtype">USE </span><a class="code" href="namespacersb.html">rsb</a><span class="keywordtype">, ONLY</span>: <a class="code" href="interfacersb_1_1rsb__lib__init.html">rsb_lib_init</a>, <a class="code" href="interfacersb_1_1rsb__lib__exit.html">rsb_lib_exit</a>, c_ptr, c_null_ptr,&amp;</div><div class="line">       &amp; <a class="code" href="namespacersb.html#a191f5492907ae4beca111b361955a791">rsb_io_want_extra_verbose_interface</a>,<a class="code" href="namespacersb.html#ac95404408be9bc2045e8455881d21377">rsb_io_want_verbose_tuning</a>,&amp;</div><div class="line">       &amp; <a class="code" href="interfacersb_1_1rsb__lib__set__opt.html">rsb_lib_set_opt</a>,<a class="code" href="namespacersb.html#a08c81f98d0bbd02f10c72b9d2c53e549">rsb_idx_kind</a></div><div class="line">      <span class="comment">! USE blas_sparse, only: RSB_BLAS_IDX_KIND ! only if using long indices</span></div><div class="line">      <span class="keywordtype">USE </span>iso_c_binding</div><div class="line">      <span class="keywordtype">IMPLICIT NONE</span></div><div class="line">      <span class="keywordtype">INTEGER</span> :: passed = 0, failed = 0</div><div class="line">      <span class="keywordtype">INTEGER(KIND=RSB_IDX_KIND)</span> :: res <span class="comment">! note: same as RSB_BLAS_IDX_KIND</span></div><div class="line">      <span class="comment">!TYPE(C_PTR),PARAMETER :: EO = RSB_NULL_EXIT_OPTIONS</span></div><div class="line">      <span class="comment">!TYPE(C_PTR),PARAMETER :: IO = RSB_NULL_INIT_OPTIONS</span></div><div class="line">      <span class="comment">! Note: using C_NULL_PTR instead of the previous lines because of http://gcc.gnu.org/bugzilla/show_bug.cgi?id=59411</span></div><div class="line">      <span class="keywordtype">TYPE</span>(c_ptr),<span class="keywordtype">PARAMETER</span> :: eo = c_null_ptr</div><div class="line">      <span class="keywordtype">TYPE</span>(c_ptr),<span class="keywordtype">PARAMETER</span> :: io = c_null_ptr</div><div class="line">      <span class="keywordtype">INTEGER(KIND=C_INT)</span>,<span class="keywordtype">TARGET</span>::ione=1</div><div class="line">      res = <a class="code" href="interfacersb_1_1rsb__lib__init.html">rsb_lib_init</a>(io)</div><div class="line">      res = <a class="code" href="interfacersb_1_1rsb__lib__set__opt.html">rsb_lib_set_opt</a>(<a class="code" href="namespacersb.html#ac95404408be9bc2045e8455881d21377">rsb_io_want_verbose_tuning</a>,c_loc(ione))</div><div class="line">      </div><div class="line">      <span class="keyword">CALL </span><a class="code" href="fortran_8F90.html#a9e8daa274f041cb50f75d64028e079ba">blas_sparse_mod_example</a>(res)</div><div class="line">      <span class="keywordflow">IF</span> (res.LT.0) failed = failed + 1</div><div class="line">      <span class="keywordflow">IF</span> (res.EQ.0) passed = passed + 1</div><div class="line"></div><div class="line">      <span class="keyword">CALL </span><a class="code" href="fortran_8F90.html#a5afdd9925e3262966d4dde1fed40cca8">blas_sparse_io_example</a>(res)</div><div class="line">      <span class="keywordflow">IF</span> (res.LT.0) failed = failed + 1</div><div class="line">      <span class="keywordflow">IF</span> (res.EQ.0) passed = passed + 1</div><div class="line"></div><div class="line">      res = <a class="code" href="interfacersb_1_1rsb__lib__exit.html">rsb_lib_exit</a>(eo)</div><div class="line">      </div><div class="line">      print *, <span class="stringliteral">&quot;FAILED:&quot;</span>, failed</div><div class="line">      print *, <span class="stringliteral">&quot;PASSED:&quot;</span>, passed</div><div class="line">      <span class="keywordflow">IF</span> (failed .GT. 0) <span class="keywordflow">THEN</span></div><div class="line">       stop 1</div><div class="line"><span class="keywordflow">      END IF</span></div><div class="line"><span class="keyword">      END PROGRAM</span></div></div><!-- fragment --> </div><h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="a5afdd9925e3262966d4dde1fed40cca8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5afdd9925e3262966d4dde1fed40cca8">&#9670;&nbsp;</a></span>blas_sparse_io_example()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine blas_sparse_io_example </td>
          <td>(</td>
          <td class="paramtype">integer(kind=rsb_idx_kind)&#160;</td>
          <td class="paramname"><em>res</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a9e8daa274f041cb50f75d64028e079ba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9e8daa274f041cb50f75d64028e079ba">&#9670;&nbsp;</a></span>blas_sparse_mod_example()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine blas_sparse_mod_example </td>
          <td>(</td>
          <td class="paramtype">integer(kind=rsb_blas_idx_kind)&#160;</td>
          <td class="paramname"><em>res</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a8ec2266d83cd6c0b762cbcbc92c0af3d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ec2266d83cd6c0b762cbcbc92c0af3d">&#9670;&nbsp;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">program main </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
